<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>å°é›ª</title>
        <link rel="stylesheet" href="css/style.css">
        <script>
            function openSettings() {
                document.getElementById('settingsModal').classList.add('active');
            }
            function openMemory() {
                document.getElementById('memoryModal').classList.add('active');
            }
            function closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }

        </script>
    </head>
<body>
    <div id="app">
        <header class="header">
            <div class="header-left">
                <div class="avatar">ğŸ’•</div>
                <div class="header-info">
                        <div class="name" id="charName">å°é›ª</div>
                        <div class="status">åœ¨çº¿</div>
                        <div class="version">v2.3</div>
                    </div>
            </div>
            <div class="header-right">
                <button class="icon-btn" id="saveBtn" title="å¿«é€Ÿå­˜æ¡£" onclick="quickSave()">ğŸ’¾</button>
                <button class="icon-btn" id="loadBtn" title="å­˜æ¡£ç®¡ç†" onclick="openSaveManager()">ğŸ“</button>
                <button class="icon-btn" id="memoryBtn" title="é•¿æœŸè®°å¿†" onclick="openMemory()">ğŸ§ </button>
                <button class="icon-btn" id="settingsBtn" title="è®¾ç½®" onclick="openSettings()">âš™ï¸</button>
            </div>
        </header>

        <main class="chat-container" id="chatContainer">
            <div class="messages" id="messages">
                <div class="message ai" data-message-id="1">
                    <div class="bubble">
                        <span class="text">ä½ å¥½å‘€ï¼ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæœ‰ä»€ä¹ˆæƒ³å’Œæˆ‘èŠèŠçš„å—ï¼ŸğŸ˜Š</span>
                        <button class="tts-btn" title="æœ—è¯»">ğŸ”Š</button>
                        <span class="memory-indicator" title="é‡è¦è®°å¿†">â­</span>
                    </div>
                    <div class="time">åˆšåˆš</div>
                </div>
            </div>
        </main>

        <footer class="input-area">
            <div class="input-wrapper">
                <textarea id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯..." rows="1"></textarea>
                <button class="send-btn" id="sendBtn">å‘é€</button>
            </div>
        </footer>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>è®¾ç½®</h2>
                <button class="close-btn" id="closeSettings" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>API è®¾ç½®</h3>
                    <div class="form-group">
                        <label>DeepSeek API å¯†é’¥</label>
                        <input type="password" id="apiKey" placeholder="sk-xxxxxxxx">
                    </div>
                    <div class="form-group">
                        <label>æ¨¡å‹é€‰æ‹©</label>
                        <select id="modelSelect">
                            <option value="deepseek-chat">DeepSeek-V3 (æ¨è)</option>
                            <option value="deepseek-reasoner">DeepSeek-R1 (æ·±åº¦æ€è€ƒ)</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>è§’è‰²è®¾ç½®</h3>
                    <div class="form-group">
                        <label>å¥¹çš„åå­—</label>
                        <input type="text" id="charNameInput" placeholder="å°é›ª">
                    </div>
                    <div class="form-group">
                        <label>æ€§æ ¼ç±»å‹</label>
                        <select id="personalitySelect">
                            <option value="gentle">æ¸©æŸ”ä½“è´´</option>
                            <option value="lively">æ´»æ³¼å¼€æœ—</option>
                            <option value="mature">æˆç†Ÿç¨³é‡</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è¯´è¯é£æ ¼</label>
                        <select id="styleSelect">
                            <option value="sweet">ç”œç¾å¯çˆ±</option>
                            <option value="elegant">ä¼˜é›…çŸ¥æ€§</option>
                            <option value="playful">ä¿çš®å¹½é»˜</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>å¥¹æ€ä¹ˆç§°å‘¼ä½ </label>
                        <input type="text" id="userNameInput" placeholder="äº²çˆ±çš„">
                    </div>
                </div>

                <div class="settings-section">
                    <h3>å¤–è§‚è®¾ç½®</h3>
                    <div class="form-group">
                        <label>ä¸»é¢˜</label>
                        <select id="themeSelect">
                            <option value="blue">è“è‰²ï¼ˆé»˜è®¤ï¼‰</option>
                            <option value="pink">ç²‰è‰²</option>
                            <option value="green">ç»¿è‰²</option>
                            <option value="dark">æ·±è‰²æ¨¡å¼</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>è¯­éŸ³è®¾ç½®</h3>
                    <div class="form-group">
                        <label>è¯­éŸ³å¼€å…³</label>
                        <label class="switch">
                            <input type="checkbox" id="ttsEnabled" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>è‡ªåŠ¨æ’­æ”¾è¯­éŸ³</label>
                        <label class="switch">
                            <input type="checkbox" id="ttsAutoPlay" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>è¯­é€Ÿ</label>
                        <input type="range" id="ttsRate" min="0.5" max="2" step="0.1" value="1">
                        <span id="ttsRateValue">1.0x</span>
                    </div>
                </div>

                <button class="save-btn" id="saveSettings">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>
    </div>

    <div class="modal" id="memoryModal">
        <div class="modal-content memory-modal">
            <div class="modal-header">
                <h2>é•¿æœŸè®°å¿†</h2>
                <button class="close-btn" id="closeMemory" onclick="closeModal('memoryModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="memory-tabs">
                    <button class="tab-btn active" data-tab="timeline">æ—¶é—´è½´</button>
                    <button class="tab-btn" data-tab="important">é‡è¦è®°å¿†</button>
                    <button class="tab-btn" data-tab="profile">ç”¨æˆ·æ¡£æ¡ˆ</button>
                    <button class="tab-btn" data-tab="add">æ·»åŠ è®°å¿†</button>
                </div>
                <div class="tab-content active" id="timelineTab">
                    <div class="memory-timeline" id="memoryTimeline">
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <div class="timeline-time">ä»Šå¤©</div>
                                <div class="memory-card">
                                    <div class="memory-header">
                                        <span class="memory-title">åˆæ¬¡è§é¢</span>
                                        <span class="memory-indicator">â­</span>
                                    </div>
                                    <div class="memory-body">
                                        <p>ä½ å¥½å‘€ï¼ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæœ‰ä»€ä¹ˆæƒ³å’Œæˆ‘èŠèŠçš„å—ï¼ŸğŸ˜Š</p>
                                    </div>
                                    <div class="memory-footer">
                                        <button class="edit-btn">ç¼–è¾‘</button>
                                        <button class="delete-btn">åˆ é™¤</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="importantTab">
                    <div class="important-memories" id="importantMemories">
                        <div class="memory-card">
                            <div class="memory-header">
                                <span class="memory-title">é‡è¦è®°å¿†</span>
                                <span class="memory-indicator">â­</span>
                            </div>
                            <div class="memory-body">
                                <p>è¿™æ˜¯ä¸€æ¡é‡è¦çš„è®°å¿†å†…å®¹ï¼Œä¼šè¢«ä¼˜å…ˆå­˜å‚¨å’Œæ£€ç´¢ã€‚</p>
                            </div>
                            <div class="memory-footer">
                                <button class="edit-btn">ç¼–è¾‘</button>
                                <button class="delete-btn">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="profileTab">
                    <div class="user-profile" id="userProfile">
                        <div class="profile-card">
                            <div class="profile-header">
                                <h3>ç”¨æˆ·æ¡£æ¡ˆ</h3>
                                <button class="edit-profile-btn">ç¼–è¾‘</button>
                            </div>
                            <div class="profile-body">
                                <div class="profile-item">
                                    <label>å§“å</label>
                                    <span>äº²çˆ±çš„</span>
                                </div>
                                <div class="profile-item">
                                    <label>ç”Ÿæ—¥</label>
                                    <span>æœªè®¾ç½®</span>
                                </div>
                                <div class="profile-item">
                                    <label>èŒä¸š</label>
                                    <span>æœªè®¾ç½®</span>
                                </div>
                                <div class="profile-item">
                                    <label>çˆ±å¥½</label>
                                    <span>æœªè®¾ç½®</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="addTab">
                    <div class="add-memory-form">
                        <h3>æ·»åŠ æ–°è®°å¿†</h3>
                        <div class="form-group">
                            <label>è®°å¿†æ ‡é¢˜</label>
                            <input type="text" id="memoryTitle" placeholder="è¾“å…¥è®°å¿†æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <label>è®°å¿†å†…å®¹</label>
                            <textarea id="memoryContent" placeholder="è¾“å…¥è®°å¿†å†…å®¹" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                            <label>è®°å¿†åˆ†ç±»</label>
                            <select id="memoryCategory">
                                <option value="personal">ä¸ªäººä¿¡æ¯</option>
                                <option value="preference">åå¥½</option>
                                <option value="event">é‡è¦äº‹ä»¶</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                        <button class="save-btn" id="saveMemory">ä¿å­˜è®°å¿†</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="long-press-menu" id="longPressMenu">
        <ul>
            <li data-action="add-to-memory">æ·»åŠ åˆ°æ°¸ä¹…è®°å¿†</li>
            <li data-action="view-details">æŸ¥çœ‹è¯¦æƒ…</li>
            <li data-action="copy">å¤åˆ¶å†…å®¹</li>
            <li data-action="delete">åˆ é™¤æ¶ˆæ¯</li>
        </ul>
    </div>

    <div class="modal" id="saveManagerModal">
        <div class="modal-content save-manager-modal">
            <div class="modal-header">
                <h2>å­˜æ¡£ç®¡ç†</h2>
                <button class="close-btn" id="closeSaveManager" onclick="closeModal('saveManagerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="save-points-list" id="savePointsList">
                </div>
                <div class="save-actions">
                    <button class="save-btn" onclick="createNewSave()">æ–°å»ºå­˜æ¡£</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/memory.js"></script>
    <script src="js/api.js"></script>
    <script src="js/tts.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
    <script>
        function quickSave() {
            try {
                console.log('å¼€å§‹å¿«é€Ÿå­˜æ¡£...');
                const savePoint = Memory.quickSave();
                console.log('å­˜æ¡£ç»“æœ:', savePoint);
                if (savePoint) {
                    alert('å­˜æ¡£æˆåŠŸï¼');
                    // åˆ·æ–°å­˜æ¡£åˆ—è¡¨
                    renderSavePoints();
                } else {
                    alert('å­˜æ¡£å¤±è´¥ï¼');
                }
            } catch (error) {
                console.error('å¿«é€Ÿå­˜æ¡£å¤±è´¥:', error);
                alert('å­˜æ¡£å¤±è´¥ï¼š' + error.message);
            }
        }
        function openSaveManager() {
            try {
                console.log('æ‰“å¼€å­˜æ¡£ç®¡ç†...');
                document.getElementById('saveManagerModal').classList.add('active');
                renderSavePoints();
            } catch (error) {
                console.error('æ‰“å¼€å­˜æ¡£ç®¡ç†å¤±è´¥:', error);
                alert('æ‰“å¼€å­˜æ¡£ç®¡ç†å¤±è´¥ï¼š' + error.message);
            }
        }
        function renderSavePoints() {
            try {
                console.log('æ¸²æŸ“å­˜æ¡£åˆ—è¡¨...');
                const savePoints = Memory.getSavePoints();
                console.log('å­˜æ¡£åˆ—è¡¨:', savePoints);
                const container = document.getElementById('savePointsList');
                
                if (savePoints.length === 0) {
                    container.innerHTML = '<p class="empty-tip">æš‚æ— å­˜æ¡£</p>';
                    return;
                }
                
                let html = '';
                savePoints.forEach(sp => {
                    const time = new Date(sp.timestamp).toLocaleString('zh-CN');
                    html += `
                        <div class="save-point-card" data-id="${sp.id}">
                            <div class="save-point-header">
                                <span class="save-point-title">${sp.description}</span>
                                <span class="save-point-time">${time}</span>
                            </div>
                            <div class="save-point-info">
                                <span class="save-point-messages">${sp.messageCount}æ¡æ¶ˆæ¯</span>
                            </div>
                            <div class="save-point-actions">
                                <button class="load-btn" onclick="loadSavePoint(${sp.id})">åŠ è½½</button>
                                <button class="delete-btn" onclick="deleteSavePoint(${sp.id})">åˆ é™¤</button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                console.error('æ¸²æŸ“å­˜æ¡£åˆ—è¡¨å¤±è´¥:', error);
                alert('æ¸²æŸ“å­˜æ¡£åˆ—è¡¨å¤±è´¥ï¼š' + error.message);
            }
        }
        function createNewSave() {
            try {
                console.log('åˆ›å»ºæ–°å­˜æ¡£...');
                const description = prompt('è¯·è¾“å…¥å­˜æ¡£æè¿°ï¼š', '');
                if (description !== null) {
                    const savePoint = Memory.saveGame(description);
                    console.log('æ–°å­˜æ¡£ç»“æœ:', savePoint);
                    if (savePoint) {
                        alert('å­˜æ¡£æˆåŠŸï¼');
                        renderSavePoints();
                    } else {
                        alert('å­˜æ¡£å¤±è´¥ï¼');
                    }
                }
            } catch (error) {
                console.error('åˆ›å»ºæ–°å­˜æ¡£å¤±è´¥:', error);
                alert('åˆ›å»ºæ–°å­˜æ¡£å¤±è´¥ï¼š' + error.message);
            }
        }
        function loadSavePoint(savePointId) {
            if (confirm('ç¡®å®šè¦åŠ è½½è¿™ä¸ªå­˜æ¡£å—ï¼Ÿå½“å‰è¿›åº¦å°†è¢«è¦†ç›–ï¼')) {
                const success = Memory.rollbackToSavePoint(savePointId);
                if (success) {
                    closeModal('saveManagerModal');
                    location.reload();
                }
            }
        }
        function deleteSavePoint(savePointId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­˜æ¡£å—ï¼Ÿ')) {
                Memory.deleteSavePoint(savePointId);
                renderSavePoints();
            }
        }
    </script>
</body>
</html>
